monolog:
  channels: ['deprecation', 'mailer']  # Ajouter 'mailer' dans les canaux globaux

when@dev:
  monolog:
    handlers:
      main:
        type: stream
        path: "%kernel.logs_dir%/%kernel.environment%.log"
        level: debug
        channels: ["!event", "!mailer"]  # Exclure 'mailer' du handler principal pour éviter la duplication

      mailer:  # Définition du handler pour 'mailer'
        type: stream
        path: "%kernel.logs_dir%/mailer.log"
        level: debug
        channels: ['mailer']

      console:  # Configuration du handler console conservée
        type: console
        process_psr_3_messages: false
        channels: ["!event", "!doctrine", "!console"]

when@test:
  monolog:
    handlers:
      main:
        type: fingers_crossed
        action_level: error
        handler: nested
        excluded_http_codes: [404, 405]
        channels: ["!event"]
      nested:
        type: stream
        path: "%kernel.logs_dir%/%kernel.environment%.log"
        level: debug

when@prod:
  monolog:
    handlers:
      main:
        type: fingers_crossed
        action_level: error
        handler: nested
        excluded_http_codes: [404, 405]
        buffer_size: 50  # Prévention des fuites mémoire
      nested:
        type: stream
        path: php://stderr
        level: debug
        formatter: monolog.formatter.json

      console:
        type: console
        process_psr_3_messages: false
        channels: ["!event", "!doctrine"]

      deprecation:  # Handler pour les dépréciations
        type: stream
        channels: [deprecation]
        path: php://stderr
        formatter: monolog.formatter.json
